<!DOCTYPE html>
<html>
<head>
    <title>Photo Gallery</title>
    <style>
        body {
            font-family: Arial;
            margin: 20px;
            background: #111;
            color: #fff;
            -webkit-touch-callout: none; /* reduce long-press options */
        }

        a.back {
            color: #4ea1ff;
            display: inline-block;
            margin-bottom: 20px;
            text-decoration: none;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .image-grid img {
            width: 100%;
            border-radius: 10px;
            cursor: pointer;
            -webkit-user-drag: none;
            user-select: none;
            -webkit-touch-callout: none;
            opacity: 0;
            animation: thumbfade 0.6s forwards;
        }

        @keyframes thumbfade {
            to { opacity: 1; }
        }

        /* LIGHTBOX OVERLAY */
        .lightbox {
            position: fixed;
            z-index: 9999;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            justify-content: center;
            align-items: center;
            overflow: hidden;
            display: none;
            touch-action: none; /* allow JS to control gestures */
        }

        .lightbox.visible {
            display: flex;
        }

        .lightbox img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            user-select: none;
            -webkit-user-select: none;
            -webkit-user-drag: none;
            -webkit-touch-callout: none;
            touch-action: none;
            transform-origin: center center;
            opacity: 0;
            transition: opacity 0.25s ease-out, transform 0.15s ease-out;
        }

        /* CLOSE BUTTON (simple X top-right) */
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 34px;
            color: white;
            cursor: pointer;
            z-index: 10000;
            user-select: none;
        }

        img {
            -webkit-user-drag: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
    </style>
</head>

<body>

    <h1>Photo Gallery</h1>
    <a class="back" href="index.html">← Back to 360 Tour</a>

    <!-- FULLSCREEN LIGHTBOX -->
    <div id="lightbox" class="lightbox">
        <span class="close-btn" onclick="closeLightbox()">✕</span>
        <img id="lightbox-img" src="">
    </div>

    <!-- IMAGE GRID (ORDER CONFIRMED) -->
    <div class="image-grid">
        <img src="gallery/CityPark.jpg" onclick="openLightbox(0)">
        <img src="gallery/NolaAtNightRiverwalk.jpg" onclick="openLightbox(1)">
        <img src="gallery/SunriseOverNolaRiverwalk.jpg" onclick="openLightbox(2)">
        <img src="gallery/SunriseOverTulane.jpg" onclick="openLightbox(3)">
        <img src="gallery/SunsetAtUNO.jpg" onclick="openLightbox(4)">
    </div>

<script>
/* IMAGE LIST (swipe order) */
const images = [
    "gallery/CityPark.jpg",
    "gallery/NolaAtNightRiverwalk.jpg",
    "gallery/SunriseOverNolaRiverwalk.jpg",
    "gallery/SunriseOverTulane.jpg",
    "gallery/SunsetAtUNO.jpg"
];

let currentIndex = 0;
let scale = 1;
let lastX = 0, lastY = 0;
let startX = 0, startY = 0;
let originX = 0, originY = 0;
let initialDistance = 0;

const lb = document.getElementById('lightbox');
const img = document.getElementById('lightbox-img');

let swipeStartX = 0;

/* Helper: show image with fade, reset zoom/pan */
function showImage(index, doFade) {
    currentIndex = index;
    if (doFade) img.style.opacity = 0;

    // reset zoom/pan
    scale = 1;
    lastX = 0;
    lastY = 0;
    img.style.transform = "translate(0px, 0px) scale(1)";
    
    img.src = images[currentIndex];

    // fade in after src set
    if (doFade) {
        requestAnimationFrame(() => {
            img.style.opacity = 1;
        });
    } else {
        img.style.opacity = 1;
    }
}

/* OPEN LIGHTBOX */
function openLightbox(index) {
    lb.classList.add('visible');
    showImage(index, true);  // fade on open
}

/* CLOSE LIGHTBOX */
function closeLightbox() {
    lb.classList.remove('visible');
}

/* SWIPE NEXT/PREV */
function nextImage() {
    const next = (currentIndex + 1) % images.length;
    showImage(next, true);   // fade on swipe
}

function prevImage() {
    const prev = (currentIndex - 1 + images.length) % images.length;
    showImage(prev, true);   // fade on swipe
}

/* PREVENT NORMAL SAVE METHODS */
document.addEventListener('contextmenu', e => {
    if (e.target.tagName === 'IMG') e.preventDefault();
});

/* Still block drag-start of images */
document.addEventListener('dragstart', e => {
    if (e.target.tagName === 'IMG') e.preventDefault();
});

/* TOUCH HANDLING FOR SWIPE, ZOOM, PAN (iPhone-safe) */
lb.addEventListener('touchstart', function(e) {
    if (e.target.classList.contains('close-btn')) return; // let X work

    if (e.touches.length === 1) {
        swipeStartX = e.touches[0].clientX;
        startX = e.touches[0].pageX;
        startY = e.touches[0].pageY;
        originX = lastX;
        originY = lastY;
    }
}, { passive: false });

lb.addEventListener('touchmove', function(e) {
    if (!lb.classList.contains('visible')) return;
    if (e.target.classList.contains('close-btn')) return;

    if (e.touches.length === 2) {
        // PINCH ZOOM
        const dx = e.touches[0].pageX - e.touches[1].pageX;
        const dy = e.touches[0].pageY - e.touches[1].pageY;
        const distance = Math.sqrt(dx*dx + dy*dy);

        if (!initialDistance) initialDistance = distance;

        scale = distance / initialDistance;
        scale = Math.min(Math.max(scale, 1), 5);

        img.style.transform = `translate(${lastX}px, ${lastY}px) scale(${scale})`;
        e.preventDefault();
        return;
    }

    if (e.touches.length === 1 && scale > 1) {
        // PAN WHEN ZOOMED
        const touch = e.touches[0];
        const deltaX = touch.pageX - startX;
        const deltaY = touch.pageY - startY;

        lastX = originX + deltaX;
        lastY = originY + deltaY;

        img.style.transform = `translate(${lastX}px, ${lastY}px) scale(${scale})`;
        e.preventDefault();
    }
}, { passive: false });

lb.addEventListener('touchend', function(e) {
    if (!lb.classList.contains('visible')) return;

    // Reset pinch base
    if (e.touches.length < 2) {
        initialDistance = 0;
    }

    // SWIPE only if not zoomed in
    if (scale === 1 && e.changedTouches && e.changedTouches.length === 1) {
        const endX = e.changedTouches[0].clientX;
        const delta = endX - swipeStartX;

        if (Math.abs(delta) > 60) {
            if (delta < 0) {
                nextImage();
            } else {
                prevImage();
            }
        }
    }
});

/* DESKTOP: MOUSE WHEEL ZOOM */
lb.addEventListener('wheel', function(e) {
    if (!lb.classList.contains('visible')) return;
    e.preventDefault();

    scale += e.deltaY * -0.002;
    scale = Math.min(Math.max(scale, 1), 5);

    img.style.transform = `translate(${lastX}px, ${lastY}px) scale(${scale})`;
}, { passive: false });

/* AUTO RESET ON ORIENTATION CHANGE */
window.addEventListener('orientationchange', () => {
    setTimeout(() => {
        if (lb.classList.contains('visible')) {
            scale = 1;
            lastX = lastY = 0;
            img.style.transform = "translate(0px, 0px) scale(1)";
        }
    }, 300);
});
</script>

</body>
</html>
